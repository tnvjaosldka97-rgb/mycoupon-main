name: Keep Railway Server Alive

on:
  schedule:
    # ë§¤ 5ë¶„ë§ˆë‹¤ ì‹¤í–‰ (GitHub Actions ìµœì†Œ ê°„ê²©)
    - cron: '*/5 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping-server:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Railway Server
        run: |
          echo "ğŸ”„ Pinging Railway server..."
          
          response=$(curl -s -o /dev/null -w "%{http_code}|%{time_total}" https://my-coupon-bridge.com/api/health)
          
          http_code=$(echo $response | cut -d'|' -f1)
          time_total=$(echo $response | cut -d'|' -f2)
          
          echo "âœ… Response: $http_code"
          echo "â±ï¸  Time: ${time_total}s"
          
          if [ "$http_code" = "200" ]; then
            echo "ğŸ‰ Server is alive and healthy!"
          else
            echo "âš ï¸  Server returned $http_code"
            exit 1
          fi
      
      - name: Ping DB Warm-up
        run: |
          echo "ğŸ”„ Warming up database connection..."
          curl -s https://my-coupon-bridge.com/healthz
          echo "âœ… DB connection warmed up!"
